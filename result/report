**渗透测试报告**

---

### 1. 项目背景和范围说明：

**公司名称：** XYZ Corp.

**网络范围：** 测试涵盖了XYZ Corp.的内部办公室网络及公共面向客户的网站（www.xyzcorp.com）。此次测试旨在全面评估网络与Web应用的安全状况，确保客户数据与业务操作的连续性与安全性。

### 2. 测试方法和工具：

| 工具名称 | 用途说明 |
| --- | --- |
| **Nmap** | 端口扫描与服务指纹识别，用于发现开放端口和服务版本，评估网络基础架构的安全状况。 |
| **TPScan** | 针对ThinkPHP框架的漏洞扫描器，用于检测该框架中的已知安全漏洞。 |
| **Struct2Scan** | 针对Apache Struts2的漏洞扫描器，用于发现Struts2框架中的安全漏洞，如远程代码执行。 |
| **Vulmap** | 多合一漏洞扫描工具，用于识别并报告广泛的安全漏洞，包括但不限于反序列化漏洞和远程代码执行。 |
| **Nikto** | Web服务器安全扫描工具，检查Web服务器配置错误、已知漏洞和危险文件，以提升Web应用安全水平。 |

### 3. 发现的漏洞和安全问题：

1. **SSH弱版本** - Nmap发现SSH服务运行的是较旧版本(8.9p1)，可能存在未修补的安全漏洞。
2. **HTTP服务过时版本** - 两个HTTP服务实例(端口80和8080)存在版本过时问题，可能包含已知漏洞。
3. **RPCBIND暴露** - RPCBIND服务暴露在公网，可能被利用进行未授权访问或服务拒绝攻击。
4. **ThinkPHP远程代码执行漏洞** - TPScan在8080端口上发现了`thinkphp_invoke_func_code_exec`漏洞，允许攻击者执行任意代码。
5. **Apache Struts2 S2_001与S2_016漏洞** - Struct2Scan检测到登录页面存在多个漏洞，可能导致远程代码执行。
6. **Apache ActiveMQ反序列化与远程代码执行漏洞** - Vulmap识别出Apache ActiveMQ的两个严重漏洞，可导致攻击者完全控制服务器。
7. **PHP后门与敏感信息泄露** - Nikto发现多个PHP后门脚本和服务器配置问题，允许读取系统文件如`/etc/hosts`。

### 4. 验证和复现：

- **SSH弱版本**：使用Nmap的`--script sshv1`脚本确认是否支持不安全的SSHv1协议。
- **ThinkPHP漏洞复现**：访问TPScan提供的`vulnurl`，观察返回的MD5哈希值是否与预期相符，证明漏洞存在。
- **Struts2漏洞复现**：构造S2_001的`payload`，通过HTTP请求发送到相应的URL，检查是否能执行系统命令。
- **Apache ActiveMQ漏洞**：利用`admin:admin`默认凭据尝试登录管理界面，然后尝试上传恶意JSP文件验证漏洞。
- **Nikto发现的漏洞**：针对每个URL和payload，使用curl或Burp Suite发送对应的HTTP请求，验证漏洞的有效性。

### 5. 风险评估和建议：

- **SSH应立即升级至最新版本**，并禁用SSHv1协议，增强远程管理的安全性。
- **更新HTTP服务至最新稳定版本**，如Apache 2.4.59或以上，以修复已知漏洞。
- **限制或移除不必要的服务**，如RPCBIND，减少攻击面。
- **针对ThinkPHP和Struts2漏洞**，及时更新框架至无漏洞版本，并实施严格的输入验证。
- **ActiveMQ需立即升级**并禁用匿名访问，加强认证和权限管理。
- **清除已发现的PHP后门**，并检查服务器是否有其他非法部署的脚本，强化Web服务器配置，如添加X-Content-Type-Options头防止MIME类型嗅探。

### 6. 总结和建议：

本次渗透测试揭示了XYZ Corp.网络和Web应用中存在的多处关键安全漏洞，包括服务版本过时、远程代码执行、反序列化漏洞以及后门的存在。立即采取措施修复这些漏洞是至关重要的，同时建议建立定期的安全审计流程，确保系统持续更新，减少外部攻击的风险。此外，加强员工安全意识培训，确保开发遵循安全编码最佳实践，也是保障公司网络安全的重要一环。